<p-drawer
  [(visible)]="visible"
  position="left"
  closable="false"
  appendTo="body"
  [closeOnEscape]="false"
  [modal]="false"
  styleClass="layout-sidebar"
>
  <ng-template #header>
    <img
      src="assets/media/colored-portrait-logo.png"
      style="width: 3.7rem"
      alt="8X CRM Logo"
    />
  </ng-template>
  <ng-template #content>
    <div class="flex flex-column h-full">
      <ul class="list-none p-0 m-0 text-center flex flex-column gap-3">
        @for (link of topMenuItems(); track $index) {
        <li>
          <a
            [routerLink]="link.routerLink"
            routerLinkActive="text-primary"
            [routerLinkActiveOptions]="{ exact: true }"
            [pTooltip]="link.label"
          >
            <i class="{{ link.icon }} text-xl font-meduim"></i>
          </a>
        </li>
        }
      </ul>
      <ul
        class="list-none p-0 m-0 text-center flex flex-column gap-3 mt-auto mb-3"
      >
        @for (link of bottomMenuItems(); track $index) {
        <li>
          <a
            [routerLink]="link.routerLink"
            routerLinkActive="text-primary"
            [routerLinkActiveOptions]="{ exact: true }"
            [pTooltip]="link.label"
          >
            <i class="{{ link.icon }} text-xl font-meduim"></i>
          </a>
        </li>
        }
      </ul>
      <ng-container *ngTemplateOutlet="settings"></ng-container>
    </div>
  </ng-template>
</p-drawer>

<ng-template #settings>
  <div class="flex justify-content-center mb-2">
    <button
      pButton
      class="border-0 bg-none p-0 hover:shadow-2"
      [rounded]="true"
      style="width: 2rem; height: 2rem"
      (click)="op.toggle($event)"
    >
      @if (currentUser()?.featured_image) {
      <img
        class="w-full h-full img-cover"
        alt=""
        [src]="currentUser()?.featured_image"
      />
      } @else {
      <svg
        xmlns="httb://www.w3.org/2000/svg"
        viewBox="0 0 32 32"
        style="display: block; height: 100%; width: 100%; fill: #fff"
        aria-label="Main navigation menu"
        role="img"
        focusable="false"
      >
        <path
          d="M16 .7C7.56.7.7 7.56.7 16S7.56 31.3 16 31.3 31.3 24.44 31.3 16 24.44.7 16 .7zm0 28c-4.02 0-7.6-1.88-9.93-4.81a12.43 12.43 0 0 1 6.45-4.4A6.5 6.5 0 0 1 9.5 14a6.5 6.5 0 0 1 13 0 6.51 6.51 0 0 1-3.02 5.5 12.42 12.42 0 0 1 6.45 4.4A12.67 12.67 0 0 1 16 28.7z"
        ></path>
      </svg>
      }
    </button>
    <p-popover #op styleClass="shadow-2">
      <ng-container
        *ngTemplateOutlet="user; context: { $implicit: currentUser() }"
      ></ng-container>
    </p-popover>
  </div>
</ng-template>

<ng-template #user let-currentUser>
  <div>
    <div class="flex align-items-center gap-3 p-3">
      <div>
        <h3 class="m-0 text-base">
          {{ currentUser?.username }}
        </h3>
        <h4 class="m-0 text-500 text-sm font-light">
          {{ currentUser?.email }}
        </h4>
      </div>
    </div>
    <div class="border-1 border-200"></div>
    <p-menu [model]="Menuitems">
      <ng-template pTemplate="item" let-item>
        <a
          [routerLink]="item?.route"
          class="p-menuitem-link text-sm font-medium"
        >
          <span [class]="item.icon"></span>
          <span class="ml-2">{{ item.label }}</span>
        </a>
      </ng-template>
    </p-menu>
  </div>
</ng-template>
